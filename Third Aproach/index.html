<!DOCTYPE html>
<html lang="en">
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Mapa 01</title>

    <!-- <button id="highlight-button">Resaltar Países</button> -->

    <link rel="stylesheet" href="style.css">

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="docs/images/favicon.ico"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="http://unpkg.com/leaflet@latest/dist/leaflet.js"></script>
    <script src="js/leaflet-providers.js"></script>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .leaflet-container {
        height: 100%;
        width: 100%;
      }
    </style>

    <style>
      #map {
        width: 700px;
        height: 400px;
      }
      .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
      }
      .info h4 {
        margin: 0 0 5px;
        color: #777;
      }
      .legend {
        text-align: left;
        line-height: 18px;
        color: #555;
      }
      .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
      }
    </style>
  </head>
  <body>

    <div class="centered-content">
      <div class="graph-text main-text">
        <h1 class="oracion">
          Mapa interactivo de los diferentes entrenadores por países
        </h1> 
      </div>

      <div>
        <div>
          <span>Deportes:&nbsp;</span>
          <select>
            <option value="all" onclick="shownotification('all')">Todos</option>
            <option value="beisbol" >   Beísbol</option>
            <option value="volley">     Volleyball</option>
            <option value="fut"     >   Futbol</option>
            <option value="rug"     >   Rugby</option>
            <option value="balonmano">  Balonmano</option>
            <option value="softbal">    Softbal</option>
            <option value="polo" onclick="resaltarPresentes3()">      Polo</option>
            <option value="hockey" onclick="resaltarPresentes1()">     Hockey</optio>
              <option value="basket" onclick="resaltarPresentes()">     Basketbol</option>
            </select>
            
            <span>Entrenadores:&nbsp;</span>
            <select>
              <option value="female">Mujeres</option>
              <option value="male">Hombres</option>
            </select>

            <span>Desarrollo:&nbsp;</span> 
              <select>
                <option value="developed" >Desarrollado</option>
                <option value="!developed">En desarrollo</option>
              </select>
            
          </div>

        
      </div>


    <div id="map"></div>

    <script type="text/javascript" src="countries.js"></script>

    <script type="text/javascript">
      const map = L.map("map").setView([20, -20], 1);

      async function loadCountryData() {
        const response = await fetch("data.json");
        const data = await response.json();
        return data;
      }

      const info = L.control();

      info.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "info");
        this.update();
        return this._div;
      };

      info.update = function (props) {
        const contents = props
          ? `<b>${props.name}</b><br />${props.count} female coaches</sup>`
          : "Hover over a countrie";
        this._div.innerHTML = `<h4>Countrie Important Info</h4>${contents}`;
      };

      info.addTo(map);

      const tiles = L.tileLayer("Thunderforest.Transport", {
        maxZoom: 20,
        attribution:
          '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, contributors',
      }).addTo(map);

      let activeCountries = ["afg", "mad"];

      // get color depending on majority of data
      function getColor(id) {
    return activeCountries.includes(id) ? 'pink' : "#FFEDA0";
    }

      function style(feature) {
        return {
          weight: 2,
          opacity: 1,
          color: "white",
          dashArray: "3",
          fillOpacity: 0.7,
          fillColor: getColor(feature.id),
        };
      }

      function highlightFeature(e) {
        const layer = e.target;

        layer.setStyle({
          weight: 5,
          color: "#666",
          dashArray: "",
          fillOpacity: 0.7,
        });

        layer.bringToFront();

        info.update(layer.feature.properties);
      }

      /* global statesData */

      const geojson = L.geoJson(countriesData, {
        style,
        onEachFeature,
      }).addTo(map);

      geojson.eachLayer(function (layer) {
        layer.bindPopup(layer.feature.properties.name);
      });

      function resetHighlight(e) {
        geojson.resetStyle(e.target);
        info.update();
      }

      async function zoomToFeature(e) {
        var layer = e.target;
        map.fitBounds(layer.getBounds());
        var country = layer.feature.id;

        const data = await loadCountryData();
        const countryName = data.countries[country].country_name;
        var popupContent = "Nombre del país: " + countryName;
        layer.bindPopup(popupContent).openPopup();
      }

    
      async function resaltarPresentes() {
        activeCountries.push('cub');
        activeCountries.push('usa');
        activeCountries.push('bra');

        updateMap();
      }

      async function resaltarPresentes1() {
        const newPaises = ['cub', 'rus', 'mex'];
        activeCountries = newPaises;
        updateMap();
      }

      async function resaltarPresentes3() {
        fetch('data.json') // Especifica la ubicación del archivo JSON
        .then(response => response.json()) // Convierte la respuesta en JSON
        .then(data => {
          // Haces algo con los datos JSON
          const continente = "África";
          activeCountries = getPaisesEnContinente(data, continente);
          updateMap();
        })
      }


      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: zoomToFeature,
        });
      }

      map.attributionControl.addAttribution(
        'copyrigth info; <a href="http://source.cu/">Source</a>'
      );

      function updateMap() {
          geojson.eachLayer(function (layer) {
            const id = layer.feature.id;

          layer.setStyle({
          weight: 2,
          opacity: 1,
          color: "white",
          dashArray: "3",
          fillOpacity: 0.7,
          fillColor: activeCountries.includes(id) ? 'pink' : getColor(id),

          });
          geojson.addTo(map);
        }
      )};


      function getPaisesEnContinente(geoJSON, continente) {
          const paisesEnContinente = [];

          for (const countryId in geoJSON.countries) {
            if (geoJSON.countries.hasOwnProperty(countryId)) {
              const country = geoJSON.countries[countryId];
              if (country.continent === continente) {
                paisesEnContinente.push(countryId);
              }
            }
          }

          return paisesEnContinente;
}

    </script>
  </body>
</html>
